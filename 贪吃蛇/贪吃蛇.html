<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* *{
            background-color: rgba(red, green, blue, alpha);
        } */
    </style>
</head>
<body>
    <script>
        //分数盒子属性
        function score() {
            this.width = "400px"
            this.height = "50px"
            this.backgroundColor = "#1e1e1e"
            this.border = "1px solid #80c342"
            this.color = "red"
            this.fontSize = "40px"
            this.textAlign = "center"
            this.lineHeight = "50px"
            this.margin = "50px auto"
            this.radius = "30px"
            //定义分数
            this._score = 0
            //定义速度
            this.speed = 200
            //方便后面函数使用
            this._Score = null
            // 调用init初始化方法
        }
        //封装分数显示
        score.prototype.show = function () {
            //新建分数盒子
            this._Score = document.createElement("div")
            this._Score.style.width = this.width
            this._Score.style.height = this.height
            this._Score.style.backgroundColor = this.backgroundColor
            this._Score.style.border = this.border
            this._Score.style.color = this.color
            this._Score.style.fontSize = this.fontSize
            this._Score.style.textAlign = this.textAlign
            this._Score.style.lineHeight = this.lineHeight
            this._Score.style.margin = this.margin
            this._Score.innerHTML = this._score
            this._Score.style.borderRadius = this.radius
            //将分数盒子添加到body
            document.body.appendChild(this._Score)
        }
        //得分
        score.prototype.speeded = function () {
            // 没吃一个分数就增加
            this._score++;
            this._Score.innerHTML = this._score
            // 当每有2分加速度
            if (this._score % 2 == 0) {

                this.speed = this.speed - this.speed / 100
            }
        }
        //封装地图属性
        function Map() {
            this.width = "800px"
            this.height = "600px"
            this.backgroundColor = "#ffffff"
            this.border = "1px solid #80c342"
            this.position = "relative"
            this.margin = "50px auto"
            this.overflow = "hidden"
            //方便后面函数使用
            this._map = null
        }
        //显示地图
        Map.prototype.show = function () {
            this._map = document.createElement("div")
            this._map.style.width = this.width
            this._map.style.height = this.height
            this._map.style.backgroundColor = this.backgroundColor
            this._map.style.border = this.border
            this._map.style.position = this.position
            this._map.style.margin = this.margin
            this._map.style.overflow = this.overflow

            // 将地图显示到body
            document.body.appendChild(this._map)

        }
        // 开始按钮属性
        function star() {
            this.width = "200px"
            this.height = "200px"
            this.backgroundColor = "#3f481f"
            this.position = "absolute"
            this.margin = "200px auto"
            this.innerHTML = "开始游戏"
            this.textAlign = "center"
            this.lineHeight = "200px"
            this.color = "#f66229"
            this.fontSize = "40px"
            this.cursor = "pointer"
            this.radius = "30px"
            this._star = null
            this.ZIndex=111
            this.left="300px"
            // this.position=absulode
        }
        //显示按钮
        star.prototype.show = function () {
            this._star = document.createElement("div")
            this._star.style.width = this.width
            this._star.style.height = this.height
            this._star.style.backgroundColor = this.backgroundColor
            this._star.style.color = this.color
            this._star.style.position=this.position
            this._star.style.fontSize = this.fontSize
            this._star.style.textAlign = this.textAlign
            this._star.style.lineHeight = this.lineHeight
            this._star.style.margin = this.margin
            this._star.innerHTML = this.innerHTML
            this._star.style.cursor = this.cursor
            this._star.style.borderRadius = this.radius
            this._star.style.zIndex= this.ZIndex
            this._star.style.left= this.left
            
            map._map.appendChild(this._star)
        }
        //点击开始按钮
        star.prototype.click = function () {
            this._star.onclick = function () {
                // 删除当前按钮
                this.remove()
                // 显示蛇
                Snake.show()
                //显示食物
                Food.show()
                //调用定时器
                set(Score.speed)
            }
        }
        // 结束按钮属性
        function end() {
            this.width = "200px"
            this.height = "200px"
            this.backgroundColor = "#e22018"
            this.position = "absolute"
            this.margin = "200px auto"
            this.innerHTML = "游戏结束!!!"
            this.textAlign = "center"
            this.lineHeight = "200px"
            this.color = "#2177c7"
            this.fontSize = "40px"
            this.cursor = "pointer"
            this.radius = "30px"
            this._end = null
            this.ZIndex = 1111
            this.left="300px"
        }
        //显示按钮
        end.prototype.show = function () {
            this._end = document.createElement("div")
            this._end.style.width = this.width
            this._end.style.height = this.height
            this._end.style.backgroundColor = this.backgroundColor
            this._end.style.color = this.color
            this._end.style.fontSize = this.fontSize
            this._end.style.textAlign = this.textAlign
            this._end.style.lineHeight = this.lineHeight
            this._end.style.margin = this.margin
            this._end.innerHTML = this.innerHTML
            this._end.style.cursor = this.cursor
            this._end.style.zIndex = this.ZIndex
            this._end.style.borderRadius = this.radius
            this._end.style.position=this.position
            this._end.style.left= this.left
            map._map.appendChild(this._end)
        }
        //点击结束按钮按钮
        end.prototype.click = function () {
            console.log(this)
            this._end.onclick = function () {
                // 删除当前按钮
                this.remove()
                //重新开始按钮出现
                Restart.show()
                //让按钮可以点击
                Restart.click()
            }
        }
        //  重新按钮属性
        function restart() {
            this.width = "200px"
            this.height = "100px"
            this.backgroundColor = "#4592ec"
            this.position = "absolute"
            this.margin = "400px auto"
            this.innerHTML = "重新开始???"
            this.textAlign = "center"
            this.lineHeight = "100px"
            this.color = "#1e1e1e"
            this.fontSize = "25px"
            this.cursor = "pointer"
            this.radius = "30px"
            this._restart = null
            this.ZIndex = "1111"
            this.left="300px"
        }
        //显示按钮
        restart.prototype.show = function () {
            this._restart = document.createElement("div")
            this._restart.style.width = this.width
            this._restart.style.height = this.height
            this._restart.style.backgroundColor = this.backgroundColor
            this._restart.style.color = this.color
            this._restart.style.fontSize = this.fontSize
            this._restart.style.textAlign = this.textAlign
            this._restart.style.lineHeight = this.lineHeight
            this._restart.style.margin = this.margin
            this._restart.innerHTML = this.innerHTML
            this._restart.style.cursor = this.cursor
            this._restart.style.zIndex = this.ZIndex
            this._restart.style.position=this.position
            this._restart.style.left= this.left
            this._restart.style.borderRadius = this.radius
            map._map.appendChild(this._restart)
        }
        //点击重新按钮按钮
        restart.prototype.click = function () {
            this._restart.onclick = function () {
                //删除按钮
                this.remove()
                //重新显示食物           
                Food.show()
                //重新定义分数
                Score._score = 0
                //将分钟重新放到分数表
                Score._Score.innerHTML = Score._score
                //重新定义速度
                Score.speed = 200
                //循环蛇身,将它删除
                Snake.body.forEach(function (value) {
                    value[3].remove()
                })
                //将蛇节变空
                Snake.body = []
                //重新定义蛇的方向
                Snake.direction = "right"
                //重新给蛇身放上数据
                Snake.body = [
                    [3, 1, "#80c342", null, "hj.png"],
                    [2, 1, "#0079d7", null, "bb.png"],
                    [1, 1, "#0079d7", null, "bb.png"],
                    [1, 0, "#0079d7", null, "bb.png"]
                ]
                // 调用定时器
                set(Score.speed)
            }
        }
        //食物属性
        function food() {
            this.width = "20px"
            this.height = "20px"
            this.backgroundColor = "#d05d80"
            this.position = "absolute"
            //方便后面函数使用
            this._food = null
            this.Image = "ff.png"
            //  食物坐标
            this.x = 0;
            this.y = 0;
        }
        //封装食物随机坐标
        food.prototype.random = function () {
            //  40是有地图宽度除于食物宽度
            // 30是由地图高度除于食物高度得来
            this.x = Math.floor(Math.random() * 40)
            this.y = Math.floor(Math.random() * 30)
        }
        //封装食物方法
        food.prototype.show = function () {
            //  食物只能存在一个.没有这个null食物不会消失倒不会占位置
            if (this._food == null) {
                this._food = document.createElement("div")
                this._food.style.width = this.width
                this._food.style.height = this.height
                this._food.style.backgroundColor = this.backgroundColor
                this._food.style.position = this.position
                this._food.style.backgroundImage = "url(" + this.Image + ")"
                //将食物添加到地图中
                map._map.appendChild(this._food)
            }
            //获取随机坐标
            //不能放if里边否则无法移动食物位置
            this.random()
            this._food.style.left = this.x * 20 + "px"
            this._food.style.top = this.y * 20 + "px"
        }
        //封装蛇
        function snake() {
            // 将整条蛇放进数组中
            this.body = [
                [3, 1, "#80c342", null, "hj.png"],
                [2, 1, "#0079d7", null, "bb.png"],
                [1, 1, "#0079d7", null, "bb.png"],
                [1, 0, "#0079d7", null, "bb.png"]
            ]
            this.width = "20px"
            this.height = "20px"
            this.position = "absolute"
            //蛇初始方向
            this.direction = "right"
        }
        //显示蛇
        snake.prototype.show = function () {
            // 循环蛇数组
            this.body.forEach(function (value) {
                //防止后面已经重复创建蛇类,所以使用null,并将null直接作为蛇节添加到地图中
                if (value[3] == null) {
                    value[3] = document.createElement("div")
                    //将每个蛇节加到地图上               
                    map._map.appendChild(value[3])
                }
                value[3].style.width = Snake.width;
                value[3].style.height = Snake.height;
                value[3].style.backgroundColor = value[2]
                value[3].style.position = Snake.position;
                value[3].style.backgroundImage = "url(" + value[4] + ")"
                //蛇节的具体位置
                value[3].style.left = value[0] * 20 + "px"
                value[3].style.top = value[1] * 20 + "px"
            })
        }
        //蛇的移动
        snake.prototype.move = function () {
            // 循环蛇的数组让后一个蛇节位置是上一个的蛇节位置
            for (var i = this.body.length - 1; i > 0; i--) {

                this.body[i][0] = this.body[i - 1][0]
                this.body[i][1] = this.body[i - 1][1]
            }
            //根据方向对数组进行改变
            //因为定时器一直循环蛇数组,所以只需要改变蛇头
            switch (this.direction) {
                // 如果方向是向上则减少y也就是蛇头index1
                case "up":
                    this.body[0][1]--
                    break;
                // 如果方向是向下则增加y也就是蛇头index1
                case "down":
                    this.body[0][1]++
                    break;
                // 如果方向是向左则减少x也就是蛇头index0
                case "left":
                    this.body[0][0]--
                    break;
                //如果方向是向右则减少x也就是蛇头index0
                case "right":
                    this.body[0][0]++
                    break;
            }
            // 重新调用显示        
            this.show()
        }
        //当点击键盘改变方向
        document.onkeydown = function (e) {

            e = e || window.event;
            switch (e.key) {
                // 如果点击的是w
                case "w":
                    //只有在蛇的方向不是想下的时候才可以改变方向
                    if (Snake.direction != "down") {
                        //    让蛇头的方向向上
                        Snake.direction = "up"
                    }
                    break;
                // 如果点击的是s
                case "s":
                    //只有在蛇的方向不是向上的时候才可以改变方向
                    if (Snake.direction != "up") {
                        //    让蛇头的方向向下
                        Snake.direction = "down"
                    }
                    break;
                // 如果点击的是a
                case "a":
                    //只有在蛇的方向不是向右的时候才可以改变方向
                    if (Snake.direction != "right") {
                        //    让蛇头的方向向右
                        Snake.direction = "left"
                    }
                    break;
                // 如果点击的是d
                case "d":
                    //只有在蛇的方向不是向左的时候才可以改变方向
                    if (Snake.direction != "left") {
                        //    让蛇头的方向向左
                        Snake.direction = "right"
                    }
                    break;

            }
        }
        //吃到食物时
        snake.prototype.eat = function () {
            // 判断蛇头是否和蛇身重叠
            if (this.body[0][0] == Food.x && this.body[0][1] == Food.y) {
                // 调用食物显示封装
                //这会改变食物位置而不是让食物消失
                Food.show()
                //加分              
                Score.speeded()
                //给蛇增加蛇节到数组最后面,因为蛇数组会一直循环,蛇尾会跟上去,所以增加的尾巴位置可以随机,因为一瞬间就跟到身身上去了
                this.body.push([1, 1, "#0079d7", null, "bb.png"]);
            }
        }
        // 当蛇碰壁时
        snake.prototype.border = function () {
            // 当蛇头的left<0
            // 当蛇头的top<0
            // 当蛇头的left>39
            // 当蛇头的top>29
            if (this.body[0][0] < 0 || this.body[0][0] > 39 || this.body[0][1] < 0 || this.body[0][1] > 29) {
                //清除定时器防止蛇死而复生
                window.clearInterval(timer);
                //d显示结束按钮
                End.show()
                //让按钮可以点击
                End.click()
            }
        }
        //当蛇吃到自己时
        snake.prototype.eatme = function () {
            // 循环从第四节开始的蛇身是否有一节和身头重复,如果有说明吃到自己了
            for (var i = 4; i < this.body.length; i++) {
                if (this.body[i][0] == this.body[0][0] && this.body[i][1] == this.body[0][1]) {
                    //清除定时器防止蛇死而复生              
                    window.clearInterval(timer);
                    //d显示结束按钮
                    End.show()
                    //让按钮可以点击
                    End.click()
                }
            }
        }
        //实例化分数
        var Score = new score()
        // 调用分数显示方法
        Score.show()
        // 实例化地图
        var map = new Map()
        // 调用地图显示方法
        map.show()
        //实例化食物
        var Food = new food()
        // 调用食物显示方法     
        //实例化蛇
        var Snake = new snake()
        // 调用蛇的显示方法
        // 实例化开始按钮
        var Star = new star()
        Star.show()
        //  点击开始按钮调用定时器,实参是速度.分数越高速度会越快
        Star.click()
        // 实咧化结束按钮
        var End = new end()
        //  实例化重新开始按钮
        var Restart = new restart()
        // 定义定时器          
        var timer
        function set(speed) {
            clearInterval(timer);
            timer = setInterval(function () {
                Snake.move()
                Snake.eat()
                Snake.border()
                Snake.eatme()
            }, speed)
        }
    </script>
</body>

</html>